<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Guangze Zhao's Blog</title><link>http://www.zhaoguangze.com/</link><description></description><atom:link href="http://www.zhaoguangze.com/feeds/tech.rss.xml" rel="self"></atom:link><lastBuildDate>Sat, 09 Jan 2016 13:23:00 +0800</lastBuildDate><item><title>OpenDayLight开发(1)-初识ODL</title><link>http://www.zhaoguangze.com/pages/2016/01/09/opendaylightkai-fa-1-chu-shi-odl.html</link><description>&lt;h1&gt;前言&lt;/h1&gt;
&lt;p&gt;今年夏天，在思科实习了三个多月的时间，主要做的是SDN方向开源控制器OpenDayLight相关的开发工作，在此之前，我不知道什么是SDN，更没接触过ODL，甚至网络方面的基础都很薄弱，一切从零开始，现记录下我的学习历程。&lt;/p&gt;
&lt;hr /&gt;
&lt;h1&gt;初识OpenDayLight&lt;/h1&gt;
&lt;h2&gt;SDN&lt;/h2&gt;
&lt;p&gt;什么是SDN？SDN，Software Define Network，即软件定义网络，简单理解，传统网络中每台交换机或路由器相互独立控制，每台设备都由控制层和数据层组成，控制层负责计算，数据层负责根据计算结果的数据转发，软件定义网络概念希望将所有设备的控制层集中起来，统一计算和调度，网络中的交换机或路由器只负责根据集中控制器计算的结果进行数据转发，从而实现网络设备的软件和硬件的剥离。这有些类似计算机中的操作系统，像windows,Linux系统可以装在很多硬件设备上，而不是操作系统和计算机硬件相绑定。&lt;/p&gt;
&lt;h2&gt;OpenDayLight&lt;/h2&gt;
&lt;p&gt;什么是OpenDayLight？OpenDayLight(ODL)是一个开源的集中控制器，其他控制器还有ONOS，Ryu等，通过ODL可以对网络进行集中计算和调度。OpenDayLight提供了一套框架，为网络设备提供南向协议，北向提供可供调用的API接口，ODL的目的是为了上层应用程序更好的控制底层网络环境。ODL开发的范围很大，可以基于ODL做北向应用程序的开发，可以开发南向协议，还可以开发从北向到南向的完整plugin。我做的大部分工作是plugin的开发。先来熟悉ODL中的几个概念。&lt;/p&gt;
&lt;h3&gt;Controller&lt;/h3&gt;
&lt;p&gt;Controller采用OSGI Framework，实现了模块化和可扩展性。
SAL即服务抽象层，是Controller最核心模块
Controller由Bundle实现，Bundle是OSGI中的基本组件，表现形式是Jar/Kar文件。
Controller控制模块间数据交互，数据存取，API调用等。&lt;/p&gt;
&lt;h3&gt;Plugin&lt;/h3&gt;
&lt;p&gt;plugin是通过SAL实现的功能模块。
运行在ODL OSGI Framework上，与ODL共享一个JVM&lt;/p&gt;
&lt;h3&gt;Karaf&lt;/h3&gt;
&lt;p&gt;OSGI是Java动态模块系统，提供了模块应用开发框架，Karaf基于OSGI的容器，把应用程序分成多个功能模块，通过依赖dependency进行管理，Karaf中引用了feature概念，feature是符合某个功能特征的bundle集的部署描述。&lt;/p&gt;
&lt;p&gt;常用Karaf命令&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Logging&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;display&lt;/span&gt;      &lt;span class="n"&gt;display&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;entire&lt;/span&gt; &lt;span class="n"&gt;log&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;tail&lt;/span&gt;         &lt;span class="n"&gt;Continuously&lt;/span&gt; &lt;span class="n"&gt;display&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt; &lt;span class="n"&gt;lines&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;log&lt;/span&gt;
&lt;span class="n"&gt;Features&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;feature&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;list&lt;/span&gt;     &lt;span class="n"&gt;List&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt; &lt;span class="n"&gt;features&lt;/span&gt; &lt;span class="n"&gt;known&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;controller&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;feature&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;  &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;feature&lt;/span&gt;
&lt;span class="n"&gt;Repository&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;mvn&lt;/span&gt;         &lt;span class="n"&gt;Specifies&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;repository&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;which&lt;/span&gt; &lt;span class="n"&gt;Karaf&lt;/span&gt; &lt;span class="n"&gt;will&lt;/span&gt; &lt;span class="n"&gt;look&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;features&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Maven&lt;/h3&gt;
&lt;p&gt;官方解释Apache Maven is a software project management and comprehension tool，Maven一个软件工程管理工具，可以控制软件工程的生命周期。&lt;/p&gt;
&lt;p&gt;Maven工程的生命周期：
Validate, Compile, Test, Package, Integration-test, Verify, Install, deploy&lt;/p&gt;
&lt;p&gt;常用Maven命令&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;clean&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;clean&lt;/span&gt; &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="n"&gt;working&lt;/span&gt; &lt;span class="n"&gt;directory&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt; &lt;span class="n"&gt;that&lt;/span&gt; &lt;span class="n"&gt;were&lt;/span&gt; &lt;span class="n"&gt;created&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;
&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;built&lt;/span&gt; &lt;span class="n"&gt;artifact&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;directed&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DskipTests&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;don&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="n"&gt;run&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;tests&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Dcheckstyle&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;skip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;ignore&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="n"&gt;style&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;OpenDayLight可以理解成一个基于OSGI框架的Maven工程。&lt;/p&gt;
&lt;h2&gt;开发过程&lt;/h2&gt;
&lt;p&gt;Code：use Intellij or Eclipse to write application code, create model, check errors&lt;/p&gt;
&lt;p&gt;Build: use Maven to build and package application, pull code into repository&lt;/p&gt;
&lt;p&gt;Test: use Karaf to run ODL and test application&lt;/p&gt;
&lt;p&gt;开发ODL plugin的过程首先定义Yang模型, 然后编译模型，自动生成部分代码和Rest API，最后编码实现逻辑。&lt;/p&gt;
&lt;h2&gt;开发环境&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;JDK&lt;/span&gt; &lt;span class="mf"&gt;1.7&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;JAVA_HOME&lt;/span&gt;
&lt;span class="n"&gt;Maven&lt;/span&gt; &lt;span class="mf"&gt;3.1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;MAVEN_HOME&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Repository&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;where&lt;/span&gt; &lt;span class="n"&gt;dependencies&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;downloaded&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;placed&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xml&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Points&lt;/span&gt; &lt;span class="n"&gt;Maven&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;where&lt;/span&gt; &lt;span class="n"&gt;repositories&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;located&lt;/span&gt;
&lt;span class="n"&gt;Git&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Install&lt;/span&gt; &lt;span class="n"&gt;Git&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt;
&lt;span class="n"&gt;IDE&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Intellij&lt;/span&gt; &lt;span class="n"&gt;IDEA&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Eclipse&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;构建plugin&lt;/h2&gt;
&lt;p&gt;创建新的plugin命令&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mvn&lt;/span&gt; &lt;span class="n"&gt;archetype&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;generate&lt;/span&gt; 
&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DarchetypeGroupId&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;opendaylight&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;controller&lt;/span&gt; 
&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DarchetypeArtifactId&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;opendaylight&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;startup&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;archetype&lt;/span&gt;    &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DarchetypeRepository&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//nexus.opendaylight.org/content/repositoryes/opendaylight.snapshot/ &lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DarchetypeCatalog&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//nexus.opendaylight.org/content/repositories/opendaylight.snapshot/archetype-catalog.xml&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;输入响应提示&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Define value for property &amp;#39;groupId&amp;#39;: : com.company.project
Define value for property &amp;#39;artifactId&amp;#39;: : project
Define value for property &amp;#39;version&amp;#39;:  1.0-SNAPSHOT: : 1.0.0-SNAPSHOT
Define value for property &amp;#39;package&amp;#39;:  com.company.project
Define value for property &amp;#39;classPrefix&amp;#39;:  &lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;artifactId&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;toUpperCase&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="cp"&gt;}${&lt;/span&gt;&lt;span class="n"&gt;artifactId&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;
Define value for property &amp;#39;copyright&amp;#39;: : Copyright (c) 2015 Company, Inc.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接着会在当前目录下生成工程的文件目录&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
    &lt;span class="n"&gt;artifacts&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;   &lt;span class="err"&gt;由&lt;/span&gt;&lt;span class="n"&gt;pom&lt;/span&gt;&lt;span class="err"&gt;文件定义工程信息&lt;/span&gt;&lt;span class="n"&gt;GroupId&lt;/span&gt;&lt;span class="err"&gt;，&lt;/span&gt;&lt;span class="n"&gt;ArtifactId&lt;/span&gt;&lt;span class="err"&gt;，&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="err"&gt;，&lt;/span&gt;&lt;span class="n"&gt;dependency&lt;/span&gt;
    &lt;span class="n"&gt;api&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;   &lt;span class="err"&gt;由&lt;/span&gt;&lt;span class="n"&gt;Yang&lt;/span&gt; &lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="err"&gt;定义的工程的&lt;/span&gt;&lt;span class="n"&gt;REST&lt;/span&gt; &lt;span class="err"&gt;和&lt;/span&gt; &lt;span class="n"&gt;Java&lt;/span&gt; &lt;span class="n"&gt;API&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;API&lt;/span&gt;&lt;span class="err"&gt;定义程序的功能接口&lt;/span&gt;
    &lt;span class="n"&gt;features&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;  &lt;span class="err"&gt;工程的&lt;/span&gt;&lt;span class="n"&gt;Karaf&lt;/span&gt; &lt;span class="n"&gt;feature&lt;/span&gt;&lt;span class="err"&gt;和彼此依赖关系&lt;/span&gt;
    &lt;span class="n"&gt;impl&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;      &lt;span class="err"&gt;工程的主要业务逻辑代码&lt;/span&gt;
    &lt;span class="n"&gt;karaf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;     &lt;span class="err"&gt;工程的客户端发行版，可运行，或安装在其他发行版&lt;/span&gt;&lt;span class="n"&gt;ODL&lt;/span&gt;&lt;span class="err"&gt;中&lt;/span&gt;
    &lt;span class="n"&gt;pom&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xml&lt;/span&gt; &lt;span class="err"&gt;项目配置文件&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接下来就可以在api目录下写Yang Model，在impl/中写实现功能代码了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Guangze Zhao</dc:creator><pubDate>Sat, 09 Jan 2016 13:23:00 +0800</pubDate><guid>tag:www.zhaoguangze.com,2016-01-09:pages/2016/01/09/opendaylightkai-fa-1-chu-shi-odl.html</guid><category>OpenDayLight</category><category>ODL</category><category>MD-SAL</category></item></channel></rss>